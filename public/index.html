<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aether Sound</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Aether Sound</h1>
    <p>Generaci√≥n musical algor√≠tmica + IA</p>
  </header>

  <!-- ===== INICIO: AJUSTES DE API KEYS (NUEVO) ===== -->
  <div class="panel" id="api-settings-panel">
    <h2>Ajustes de API Keys (BYOK - Trae tu propia clave)</h2>
    <p class="hint">Guarda tus claves de API aqu√≠. Se almacenar√°n de forma segura solo en tu navegador.</p>
    <div class="form-col" style="gap: 12px; margin-top: 12px;">
        <div class="api-key-input">
            <label for="geminiApiKey">Gemini API Key (Google):</label>
            <input type="password" id="geminiApiKey" placeholder="Pega tu clave de Google AI Studio aqu√≠">
        </div>
        <div class="api-key-input">
            <label for="openaiApiKey">OpenAI API Key (ChatGPT):</label>
            <input type="password" id="openaiApiKey" placeholder="Pega tu clave de OpenAI aqu√≠">
        </div>
        <!-- Puedes a√±adir m√°s servicios aqu√≠ en el futuro -->
        <div class="actions">
          <button id="saveApiKeysButton">Guardar Claves</button>
        </div>
    </div>
  </div>
  <!-- ===== FIN: AJUSTES DE API KEYS ===== -->

  <main>
    <section class="grid">
      <div class="panel">
        <h2>Generaci√≥n Local</h2>
        <div class="actions">
          <button id="btn-composition">Composici√≥n</button>
          <button id="btn-drums">Bater√≠a</button>
          <button id="btn-synth">Synth</button>
        </div>
      </div>

      <!-- PANEL DE GENERACI√ìN CREATIVA (NUEVO) -->
      <div class="panel">
        <h2>Generaci√≥n Creativa</h2>
        <p class="hint">Usa estos controles para guiar la creaci√≥n musical.</p>
        <div class="controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-top: 12px;">
            <div class="control-group">
                <label for="key-select">Tonalidad:</label>
                <select id="key-select">
                    <option value="C" selected>Do</option>
                    <option value="C#">Do#</option>
                    <option value="D">Re</option>
                    <option value="D#">Re#</option>
                    <option value="E">Mi</option>
                    <option value="F">Fa</option>
                    <option value="F#">Fa#</option>
                    <option value="G">Sol</option>
                    <option value="G#">Sol#</option>
                    <option value="A">La</option>
                    <option value="A#">La#</option>
                    <option value="B">Si</option>
                </select>
            </div>
            <div class="control-group">
                <label for="scale-select">Escala:</label>
                <select id="scale-select">
                    <option value="major" selected>Mayor</option>
                    <option value="minor">Menor</option>
                    <option value="dorian">D√≥rica</option>
                    <option value="phrygian">Frigia</option>
                    <option value="lydian">Lidia</option>
                    <option value="mixolydian">Mixolidia</option>
                </select>
            </div>
            <div class="control-group">
                <label for="tempo-slider">Tempo (BPM): <span id="tempo-value">120</span></label>
                <input type="range" id="tempo-slider" min="60" max="180" value="120">
            </div>
            <!-- NUEVO: Selector de patr√≥n de bater√≠a -->
            <div class="control-group">
                <label for="drum-pattern-select">Patr√≥n de Bater√≠a:</label>
                <select id="drum-pattern-select">
                    <option value="pop-rock" selected>Pop-Rock</option>
                    <option value="funk">Funk</option>
                    <option value="electronic">Electr√≥nico</option>
                    <option value="none">Sin Bater√≠a</option>
                </select>
            </div>
        </div>
        <div class="actions" style="margin-top: 16px;">
          <button id="generate-creative-btn">Generar</button>
          <button id="evolve-btn" disabled>Evolve con IA ‚ú®</button>
          <button id="export-midi-btn" disabled>Exportar a MIDI</button>
        </div>
        <!-- El reproductor de audio ya no es necesario aqu√≠, Tone.js lo maneja -->
        <!-- <audio id="creative-audio-player" controls style="width: 100%; margin-top: 12px;"></audio> -->
        <!-- NUEVO: Contenedor para las variaciones -->
        <div id="evolve-variations-container" class="variations-container">
            <!-- Las variaciones se insertar√°n aqu√≠ din√°micamente -->
        </div>
      </div>

      <div class="panel">
        <h2>Orquestaci√≥n IA</h2>
        <div class="form-row">
          <label>
            Consulta
            <input id="ai-query" type="text" placeholder="ambient generative" />
          </label>
          <label>
            M√°x. items
            <input id="ai-max" type="number" min="1" max="25" value="10" />
          </label>
          <button id="btn-ai">Buscar + Componer</button>
        </div>

        <h3>Fuentes</h3>
        <ul id="sources-list"></ul>
        <h3>Plan</h3>
        <pre id="plan-pre" class="plan"></pre>
      </div>

      <div class="panel">
        <h2>Salidas</h2>
        <div class="actions">
          <button id="btn-refresh">Actualizar Lista</button>
          <!-- NUEVO: Sync autom√°tico -->
          <button id="btn-sync-toggle" title="Conectar/Desconectar sincronizaci√≥n autom√°tica">Sync</button>
          <span id="sync-status" class="hint"></span>
        </div>
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
          <input id="output-filter" type="text" placeholder="Filtrar archivos..." style="min-width:200px;" />
        </div>
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
          <label style="display:flex;align-items:center;gap:6px;">
            Pitch Shift seleccionados (¬±semitonos)
            <input id="batch-semi" type="number" value="0" step="1" min="-12" max="12" style="width:80px;" />
          </label>
          <label style="display:flex;align-items:center;gap:6px;">
            <input id="batch-preserve" type="checkbox" /> Preservar duraci√≥n
          </label>
          <button id="btn-batch-pitch">Aplicar a seleccionados</button>
        </div>
        <!-- NUEVO: Mezcla + Compartir + IA Transiciones -->
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
          <label style="display:flex;align-items:center;gap:6px;">
            Crossfade (s) <input id="mix-sec" type="number" min="1" max="30" value="8" style="width:72px;" />
          </label>
          <button id="btn-ai-trans">Sugerir Transici√≥n (IA)</button>
          <button id="btn-mix-crossfade">Mezclar seleccionados</button>
          <button id="btn-apply-plan" disabled>Aplicar plan IA</button>
          <button id="btn-share-last" disabled>Compartir √∫ltimo mix</button>
          <button id="btn-analytics" title="Ver resumen de analytics">Ver Analytics</button>
        </div>
        <pre id="ai-trans-plan" class="plan" style="display:block;max-height:160px;overflow:auto;"></pre>
        <pre id="analytics-pre" class="plan" style="display:block;max-height:160px;overflow:auto;"></pre>
        <ul id="output-list"></ul>
        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <label style="display:inline-flex; align-items:center; gap:6px; padding:6px 10px; background:#333; color:#fff; border-radius:6px; cursor:pointer;">
            <input id="upload-input" type="file" accept=".wav,.mp3,.ogg,.flac" style="display:none" />
            Subir archivo
          </label>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <label for="keysnap-key">Tonalidad:</label>
            <select id="keysnap-key">
              <option value="0">C</option>
              <option value="1">C#</option>
              <option value="2">D</option>
              <option value="3">D#</option>
              <option value="4">E</option>
              <option value="5">F</option>
              <option value="6">F#</option>
              <option value="7">G</option>
              <option value="8">G#</option>
              <option value="9">A</option>
              <option value="10">A#</option>
              <option value="11">B</option>
            </select>
            <label for="keysnap-scale">Escala:</label>
            <select id="keysnap-scale">
              <option value="major" selected>Mayor</option>
              <option value="minor">Menor</option>
            </select>
          </div>
          <button id="btn-keysnap" title="AutoTune (KeySnap) la pista seleccionada">KeySnap</button>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <label for="crossfade-sec">Crossfade (s):</label>
            <input id="crossfade-sec" type="number" min="2" max="30" step="1" value="8" style="width:64px;" />
            <button id="btn-crossfade" title="Crear mezcla crossfade con 2 pistas seleccionadas">Crear Crossfade</button>
            <button id="btn-copylink" title="Copiar link del archivo seleccionado">Copiar link</button>
          </div>
          <button id="btn-ipfs" title="Subir a IPFS (web3.storage) la pista seleccionada">Subir a IPFS</button>
          <span id="ipfs-result" style="color:#0c0; font-size:0.9em;"></span>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <button id="btn-fingerprint" title="Generar fingerprint de la pista seleccionada (WAV)">Fingerprint</button>
          </div>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <label for="copyright-thr">Umbral:</label>
            <input id="copyright-thr" type="number" min="0" max="1" step="0.01" value="0.92" style="width:72px;" />
            <button id="btn-copyright" title="Comparar 2 pistas WAV seleccionadas para posible copia">Check Copyright</button>
            <span id="copyright-result" style="font-size:0.9em;"></span>
          </div>
        </div>
      </div>

      <!-- PANEL DEL ASISTENTE DE MASTERIZACI√ìN IA -->
      <div class="panel">
        <h2>Asistente de Masterizaci√≥n IA</h2>
        <div class="form-col" style="gap: 12px;">
          <label>Pista Principal (Mezcla)
            <input id="master-main-file" type="file" accept=".wav,.mp3,.ogg,.flac" required />
          </label>
          <label>Pista de Referencia (Opcional)
            <input id="master-ref-file" type="file" accept=".wav,.mp3,.ogg,.flac" />
          </label>
          <label>Pista de Voz (Opcional)
            <input id="master-vocal-file" type="file" accept=".wav,.mp3,.ogg,.flac" />
          </label>
          <button id="btn-master-analyze">Analizar y Obtener Sugerencias</button>
        </div>
        <div id="mastering-results-container" style="margin-top: 16px;">
          <h3>Resultados del An√°lisis:</h3>
          <pre id="mastering-results" class="plan" style="max-height: 400px; overflow: auto;"></pre>
        </div>
      </div>

      <!-- Mixer Pro: Interfaz de mezclas profesional (Web Audio + WebMIDI) -->
      <div class="panel" id="mixer-pro">
        <h2>Mixer Pro</h2>
        <div class="grid-2">
          <div>
            <h3>Deck A</h3>
            <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
              <button id="deckA-load-selected" title="Cargar primer seleccionado">Cargar seleccionado</button>
              <button id="deckA-play">Play/Pause</button>
              <button id="deckA-stop">Stop</button>
              <button id="deckA-clear" title="Vaciar deck">Limpiar</button>
              <label>Tempo/Pitch <input id="deckA-rate" type="range" min="0.5" max="1.5" step="0.01" value="1"/></label>
              <label>Gain <input id="deckA-gain" type="range" min="0" max="2" step="0.01" value="1"/></label>
            </div>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <label>Filtro LPF <input id="deckA-filter" type="range" min="200" max="18000" step="10" value="18000"/></label>
              <label>Echo Time (s) <input id="deckA-echo-time" type="range" min="0" max="1" step="0.01" value="0.25"/></label>
              <label>Echo FB <input id="deckA-echo-fb" type="range" min="0" max="0.95" step="0.01" value="0.2"/></label>
            </div>
            <!-- Visualizador y progreso (Deck A) -->
            <div class="deck-visual-row">
              <canvas id="deckA-vis" class="vis" height="100"></canvas>
              <div id="deckA-progress" class="progress-ring" title="Progreso"></div>
            </div>
            <audio id="deckA-media" crossorigin="anonymous" style="width:100%"></audio>
            <div id="deckA-track" class="deck-track"></div>
          </div>

          <div>
            <h3>Deck B</h3>
            <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
              <button id="deckB-load-selected" title="Cargar segundo seleccionado">Cargar seleccionado</button>
              <button id="deckB-play">Play/Pause</button>
              <button id="deckB-stop">Stop</button>
              <button id="deckB-clear" title="Vaciar deck">Limpiar</button>
              <label>Tempo/Pitch <input id="deckB-rate" type="range" min="0.5" max="1.5" step="0.01" value="1"/></label>
              <label>Gain <input id="deckB-gain" type="range" min="0" max="2" step="0.01" value="1"/></label>
            </div>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <label>Filtro LPF <input id="deckB-filter" type="range" min="200" max="18000" step="10" value="18000"/></label>
              <label>Echo Time (s) <input id="deckB-echo-time" type="range" min="0" max="1" step="0.01" value="0.25"/></label>
              <label>Echo FB <input id="deckB-echo-fb" type="range" min="0" max="0.95" step="0.01" value="0.2"/></label>
            </div>
            <!-- Visualizador y progreso (Deck B) -->
            <div class="deck-visual-row">
              <canvas id="deckB-vis" class="vis" height="100"></canvas>
              <div id="deckB-progress" class="progress-ring" title="Progreso"></div>
            </div>
            <audio id="deckB-media" crossorigin="anonymous" style="width:100%"></audio>
            <div id="deckB-track" class="deck-track"></div>
          </div>
        </div>

        <div class="actions" style="gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px;">
          <label style="min-width:220px;">Crossfader <input id="xfader" type="range" min="0" max="1" step="0.001" value="0.5" style="width:180px;"/></label>
          <div class="actions" style="gap:8px;align-items:center;">
            <button id="midi-connect">Conectar MIDI</button>
            <select id="midi-inputs"><option value="">(sin dispositivos)</option></select>
            <button id="midi-learn-xfader">Aprender Crossfader</button>
            <span id="midi-status" class="hint"></span>
            <small class="hint">Atajo: Ctrl+K abre la Paleta de Comandos</small>
          </div>
        </div>

        <details>
          <summary>Biblioteca y b√∫squeda (IA)</summary>
          <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
            <input id="mixer-query" type="text" placeholder="house 125bpm" style="flex:1;min-width:240px;"/>
            <button id="btn-mixer-search">Buscar m√∫sica (IA)</button>
            <button id="deckA-load-local">Cargar A (local seleccionado)</button>
            <button id="deckB-load-local">Cargar B (local seleccionado)</button>
            <input id="github-query" type="text" placeholder="repo:usuario/proyecto extension:wav" style="flex:1;min-width:240px;"/>
            <button id="btn-github-search" title="Buscar en GitHub (code search)">Buscar en GitHub</button>
            <!-- NUEVO: B√∫squeda iTunes -->
            <input id="itunes-query" type="text" placeholder="artista o canci√≥n (iTunes)" style="flex:1;min-width:240px;"/>
            <button id="btn-itunes-search" title="Buscar en iTunes (Apple Music)">Buscar en iTunes</button>
          </div>

          <!-- NUEVO: Asistente Gemini -->
          <div class="form-col" style="margin-top:8px;gap:8px;">
            <label>Asistente Gemini
              <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
                <select id="assist-module">
                  <option value="creacion">Creaci√≥n</option>
                  <option value="publicacion">Publicaci√≥n</option>
                  <option value="web3">Web3</option>
                  <option value="marketing">Marketing</option>
                </select>
                <textarea id="assist-context" rows="3" style="flex:1;min-width:260px;" placeholder="Cu√©ntame tu objetivo o contexto..."></textarea>
                <button id="btn-assist">Asistir</button>
              </div>
            </label>
            <pre id="assist-output" class="hint" style="white-space:pre-wrap;margin:0;"></pre>
          </div>

          <ul id="mixer-results"></ul>
          <ul id="github-results"></ul>
          <!-- NUEVO: Resultados iTunes -->
          <ul id="itunes-results"></ul>
          <small class="hint">Puedes usar operadores de GitHub: repo:, path:, extension:. Ej.: repo:aetereum/Aether-Sound path:output extension:wav</small>
          <small class="hint">Reproducci√≥n remota depende de CORS/formatos del origen. Se recomienda descargar/liberar a la biblioteca local cuando sea posible.</small>
        </details>
      </div>

      <div class="panel">
        <h2>√Ålbum</h2>
        <div class="form-col">
          <label>T√≠tulo <input id="album-title" type="text" placeholder="Mi √Ålbum" /></label>
          <label>Artista <input id="album-artist" type="text" placeholder="Aether" /></label>
          <label>Descripci√≥n <textarea id="album-desc" rows="3" placeholder="Notas del √°lbum..."></textarea></label>
          <button id="btn-create-album">Crear √Ålbum</button>
          <div id="album-result" class="hint"></div>
          <div class="actions" style="margin-top:8px;gap:8px;flex-wrap:wrap;">
            <button id="btn-mint-hedera" disabled>Mint en Hedera</button>
            <button id="btn-publish-spotify" disabled>Publicar en Spotify</button>
          </div>
          <div id="publish-result" class="hint"></div>
          
          <!-- NUEVO: utilidades Hedera -->
          <hr />
          <div class="form-col">
            <h3>Split NFT Collection (Hedera)</h3>
            <div class="form-col" style="gap:8px;">
              <label>Nombre colecci√≥n <input id="split-name" type="text" placeholder="Aether Sounds Vol.1" /></label>
              <label>S√≠mbolo <input id="split-symbol" type="text" placeholder="ASND" /></label>
              <label>Tesorer√≠a <input id="split-treasury" type="text" placeholder="0.0.1234" /></label>
              <div style="border:1px solid #333;padding:8px;border-radius:6px;background:#2a2a2a;">
                <strong>Splits/Royalties:</strong>
                <div id="splits-container" style="margin-top:6px;"></div>
                <div class="actions" style="gap:8px;margin-top:6px;">
                  <button id="btn-add-split" type="button">+ A√±adir Split</button>
                  <span class="hint" id="splits-sum" style="font-size:0.85em;color:#888;">BPS total: 0</span>
                </div>
              </div>
              <div class="actions" style="gap:8px;flex-wrap:wrap;">
                <button id="btn-split-create">Crear Collection</button>
                <button id="btn-split-mint" disabled>Mint NFT</button>
                <button id="btn-split-associate" disabled>Asociar Token</button>
                <button id="btn-split-transfer" disabled>Transferir NFT</button>
              </div>
              <div class="form-col" style="margin-top:8px;gap:6px;">
                <label>Metadata NFT <textarea id="split-metadata" rows="3" placeholder='{"name":"Track #1","description":"My music","external_url":"https://aether.sound"}'></textarea></label>
                <label>Cuenta destino para transferir <input id="split-to-account" type="text" placeholder="0.0.xxxxx" /></label>
              </div>
              <div id="split-result" class="hint" style="margin-top:8px;"></div>
            </div>
            
            <hr />
            <h3>Hedera (asociaci√≥n y consulta)</h3>
            <label>AccountId artista <input id="hedera-account" type="text" placeholder="0.0.1234" /></label>
            <label>TokenId <input id="hedera-token" type="text" placeholder="0.0.5678" /></label>
            <label>Serial <input id="hedera-serial" type="number" min="0" step="1" placeholder="1" /></label>
            <label>Private Key (opcional)
              <input id="hedera-private-key" type="password" placeholder="302e..." />
            </label>
            <label>Destino (accountId)
              <input id="hedera-to" type="text" placeholder="0.0.xxxxx" />
            </label>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-assoc-check">Check asociaci√≥n</button>
              <button id="btn-assoc-prepare">Prepare asociaci√≥n</button>
              <button id="btn-assoc-submit">Submit asociaci√≥n</button>
              <button id="btn-nft-owner">Owner NFT</button>
              <button id="btn-nft-list">Listar NFTs de la cuenta</button>
              <button id="btn-nft-transfer">Transferir NFT</button>
            </div>
            <label>Transacci√≥n firmada (base64)
              <textarea id="assoc-tx-base64" rows="3" placeholder="Pega aqu√≠ la transacci√≥n firmada"></textarea>
            </label>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-copy-base64">Copiar base64</button>
              <button id="btn-clear-base64">Limpiar</button>
            </div>
            <div id="hedera-result" class="hint"></div>
            <pre id="hedera-list-pre" class="plan" title="Doble clic para cargar m√°s si hay paginaci√≥n"></pre>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-nft-my">Ver mis NFTs</button>
              <button id="btn-nft-more">Cargar m√°s</button>
            </div>
            <div id="hedera-gallery" class="grid" style="grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px;"></div>
            
            <hr />
            <h3>Wallet</h3>
            <div class="grid-3">
              <label>WalletConnect Project ID
                <input id="wc-project-id" type="text" placeholder="proj_********" />
              </label>
            </div>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-wallet-connect">Conectar Wallet</button>
              <button id="btn-assoc-wallet">Firmar asociaci√≥n (wallet)</button>
            </div>
            <div id="wallet-status" class="hint"></div>
          </div>
        </div>
      </div>
      <div class="panel" id="pulses-panel">
        <h2>Pulsos</h2>
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
           <label>D√≠as <input id="pulses-days" type="number" min="1" max="30" value="7" style="width:80px;"/></label>
           <button id="btn-pulses-latest">Ver √∫ltimo pulso</button>
           <button id="btn-pulses-generate">Generar pulso</button>
           <a id="pulses-file-link" href="#" target="_blank" class="hint" style="margin-left:8px;"></a>
         </div>
         <div id="pulses-summary" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; align-items: stretch;"></div>
         <pre id="pulses-pre" class="plan" style="display:block;max-height:200px;overflow:auto;"></pre>
      </div>

      <div class="panel" id="bi-panel">
        <h2>BI (Anal√≠tica)</h2>
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
          <label>D√≠as
            <input id="bi-days" type="number" min="1" max="90" value="30" style="width:80px;"/>
          </label>
          <button id="btn-bi-trends">Trends</button>
          <button id="btn-bi-audience">Audience DNA</button>
          <button id="btn-bi-roi">ROI</button>
        </div>
        <div id="bi-summary" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; align-items: stretch;"></div>
        <pre id="bi-pre" class="plan" style="display:block;max-height:220px;overflow:auto;"></pre>
      </div>

      <div class="panel" id="credits-panel">
        <h2>Cr√©ditos & EPK</h2>
        <div class="form-col" style="gap:8px;">
          <div class="grid-3">
            <label>T√≠tulo <input id="cred-title" type="text" placeholder="Nombre del single/√°lbum" /></label>
            <label>Artista <input id="cred-artist" type="text" placeholder="Artista principal" /></label>
            <label>Cover URL <input id="cred-cover" type="url" placeholder="https://.../cover.jpg" /></label>
          </div>
          <div class="grid-3">
            <label>ISRC <input id="cred-isrc" type="text" placeholder="ISRC" /></label>
            <label>ISWC <input id="cred-iswc" type="text" placeholder="ISWC" /></label>
            <label>UPC/EAN <input id="cred-upc" type="text" placeholder="UPC/EAN" /></label>
          </div>
          <div class="grid-3">
            <label>Spotify <input id="cred-spotify" type="url" placeholder="https://open.spotify.com/..." /></label>
            <label>Apple Music <input id="cred-apple" type="url" placeholder="https://music.apple.com/..." /></label>
            <label>YouTube <input id="cred-youtube" type="url" placeholder="https://youtube.com/..." /></label>
          </div>
          <div class="grid-2">
            <label>Instagram <input id="cred-instagram" type="url" placeholder="https://instagram.com/..." /></label>
            <label>Website <input id="cred-website" type="url" placeholder="https://mi-sitio.com" /></label>
          </div>
          <label>Contacto <input id="cred-contact" type="text" placeholder="manager@dominio.com | +54..." /></label>
          <label>Notas <textarea id="cred-notes" rows="3" placeholder="Notas de prensa, bio, logros, gira..."></textarea></label>
          <div class="card" style="background:#2a2a2a; border:1px solid #333; border-radius:8px; padding:8px;">
            <strong>People (rol ‚Üí nombre)</strong>
            <div id="cred-people" class="form-col" style="gap:6px;"></div>
            <div class="actions" style="gap:8px;">
              <button id="btn-people-add" type="button">+ A√±adir persona</button>
            </div>
          </div>
          <div class="card" style="background:#2a2a2a; border:1px solid #333; border-radius:8px; padding:8px;">
            <strong>Splits (party ‚Üí BPS)</strong>
            <div id="cred-splits" class="form-col" style="gap:6px;"></div>
            <div class="actions" style="gap:8px;">
              <button id="btn-split-add" type="button">+ A√±adir split</button>
              <span id="cred-bps-sum" class="hint">BPS total: 0</span>
            </div>
          </div>
          <div class="actions" style="gap:8px; flex-wrap:wrap;">
            <button id="btn-cred-save">Guardar cr√©ditos</button>
            <button id="btn-epk-gen">Generar EPK</button>
            <a id="epk-link" href="#" target="_blank" class="hint"></a>
          </div>
          <pre id="cred-result" class="plan" style="display:block;max-height:160px;overflow:auto;"></pre>
        </div>
      </div>
    </section>
  </main>

  <!-- Paleta de Comandos (Ctrl+K) -->
  <div id="cmdk" class="cmdk hidden" role="dialog" aria-modal="true" aria-label="Paleta de Comandos">
    <div class="cmdk-panel">
      <input id="cmdk-input" type="text" placeholder="Escribe un comando (ej: play a, stop b, cargar a, buscar itunes)" autocomplete="off" />
      <ul id="cmdk-list"></ul>
      <div class="cmdk-hint">Enter para ejecutar ‚Ä¢ ESC para cerrar</div>
    </div>
  </div>

  <footer>
    <small>¬© 2025 Aether Sound</small>
  </footer>

  <script src="/client.js"></script>
  <script src="/innovations.js"></script>
</body>
</html>
            <input id="upload-input" type="file" accept=".wav,.mp3,.ogg,.flac" style="display:none" />
            Subir archivo
          </label>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <label for="keysnap-key">Tonalidad:</label>
            <select id="keysnap-key">
              <option value="0">C</option>
              <option value="1">C#</option>
              <option value="2">D</option>
              <option value="3">D#</option>
              <option value="4">E</option>
              <option value="5">F</option>
              <option value="6">F#</option>
              <option value="7">G</option>
              <option value="8">G#</option>
              <option value="9">A</option>
              <option value="10">A#</option>
              <option value="11">B</option>
            </select>
            <label for="keysnap-scale">Escala:</label>
            <select id="keysnap-scale">
              <option value="major" selected>Mayor</option>
              <option value="minor">Menor</option>
            </select>
          </div>
          <button id="btn-keysnap" title="AutoTune (KeySnap) la pista seleccionada">KeySnap</button>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <label for="crossfade-sec">Crossfade (s):</label>
            <input id="crossfade-sec" type="number" min="2" max="30" step="1" value="8" style="width:64px;" />
            <button id="btn-crossfade" title="Crear mezcla crossfade con 2 pistas seleccionadas">Crear Crossfade</button>
            <button id="btn-copylink" title="Copiar link del archivo seleccionado">Copiar link</button>
          </div>
          <button id="btn-ipfs" title="Subir a IPFS (web3.storage) la pista seleccionada">Subir a IPFS</button>
          <span id="ipfs-result" style="color:#0c0; font-size:0.9em;"></span>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <button id="btn-fingerprint" title="Generar fingerprint de la pista seleccionada (WAV)">Fingerprint</button>
          </div>
          <div style="display:inline-flex; gap:6px; align-items:center;">
            <label for="copyright-thr">Umbral:</label>
            <input id="copyright-thr" type="number" min="0" max="1" step="0.01" value="0.92" style="width:72px;" />
            <button id="btn-copyright" title="Comparar 2 pistas WAV seleccionadas para posible copia">Check Copyright</button>
            <span id="copyright-result" style="font-size:0.9em;"></span>
          </div>
        </div>
      </div>

      <!-- Mixer Pro: Interfaz de mezclas profesional (Web Audio + WebMIDI) -->
      <div class="panel" id="mixer-pro">
        <h2>Mixer Pro</h2>
        <div class="grid-2">
          <div>
            <h3>Deck A</h3>
            <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
              <button id="deckA-load-selected" title="Cargar primer seleccionado">Cargar seleccionado</button>
              <button id="deckA-play">Play/Pause</button>
              <button id="deckA-stop">Stop</button>
              <button id="deckA-clear" title="Vaciar deck">Limpiar</button>
              <label>Tempo/Pitch <input id="deckA-rate" type="range" min="0.5" max="1.5" step="0.01" value="1"/></label>
              <label>Gain <input id="deckA-gain" type="range" min="0" max="2" step="0.01" value="1"/></label>
            </div>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <label>Filtro LPF <input id="deckA-filter" type="range" min="200" max="18000" step="10" value="18000"/></label>
              <label>Echo Time (s) <input id="deckA-echo-time" type="range" min="0" max="1" step="0.01" value="0.25"/></label>
              <label>Echo FB <input id="deckA-echo-fb" type="range" min="0" max="0.95" step="0.01" value="0.2"/></label>
            </div>
            <!-- Visualizador y progreso (Deck A) -->
            <div class="deck-visual-row">
              <canvas id="deckA-vis" class="vis" height="100"></canvas>
              <div id="deckA-progress" class="progress-ring" title="Progreso"></div>
            </div>
            <audio id="deckA-media" crossorigin="anonymous" style="width:100%"></audio>
            <div id="deckA-track" class="deck-track"></div>
          </div>

          <div>
            <h3>Deck B</h3>
            <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
              <button id="deckB-load-selected" title="Cargar segundo seleccionado">Cargar seleccionado</button>
              <button id="deckB-play">Play/Pause</button>
              <button id="deckB-stop">Stop</button>
              <button id="deckB-clear" title="Vaciar deck">Limpiar</button>
              <label>Tempo/Pitch <input id="deckB-rate" type="range" min="0.5" max="1.5" step="0.01" value="1"/></label>
              <label>Gain <input id="deckB-gain" type="range" min="0" max="2" step="0.01" value="1"/></label>
            </div>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <label>Filtro LPF <input id="deckB-filter" type="range" min="200" max="18000" step="10" value="18000"/></label>
              <label>Echo Time (s) <input id="deckB-echo-time" type="range" min="0" max="1" step="0.01" value="0.25"/></label>
              <label>Echo FB <input id="deckB-echo-fb" type="range" min="0" max="0.95" step="0.01" value="0.2"/></label>
            </div>
            <!-- Visualizador y progreso (Deck B) -->
            <div class="deck-visual-row">
              <canvas id="deckB-vis" class="vis" height="100"></canvas>
              <div id="deckB-progress" class="progress-ring" title="Progreso"></div>
            </div>
            <audio id="deckB-media" crossorigin="anonymous" style="width:100%"></audio>
            <div id="deckB-track" class="deck-track"></div>
          </div>
        </div>

        <div class="actions" style="gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px;">
          <label style="min-width:220px;">Crossfader <input id="xfader" type="range" min="0" max="1" step="0.001" value="0.5" style="width:180px;"/></label>
          <div class="actions" style="gap:8px;align-items:center;">
            <button id="midi-connect">Conectar MIDI</button>
            <select id="midi-inputs"><option value="">(sin dispositivos)</option></select>
            <button id="midi-learn-xfader">Aprender Crossfader</button>
            <span id="midi-status" class="hint"></span>
            <small class="hint">Atajo: Ctrl+K abre la Paleta de Comandos</small>
          </div>
        </div>

        <details>
          <summary>Biblioteca y b√∫squeda (IA)</summary>
          <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
            <input id="mixer-query" type="text" placeholder="house 125bpm" style="flex:1;min-width:240px;"/>
            <button id="btn-mixer-search">Buscar m√∫sica (IA)</button>
            <button id="deckA-load-local">Cargar A (local seleccionado)</button>
            <button id="deckB-load-local">Cargar B (local seleccionado)</button>
            <input id="github-query" type="text" placeholder="repo:usuario/proyecto extension:wav" style="flex:1;min-width:240px;"/>
            <button id="btn-github-search" title="Buscar en GitHub (code search)">Buscar en GitHub</button>
            <!-- NUEVO: B√∫squeda iTunes -->
            <input id="itunes-query" type="text" placeholder="artista o canci√≥n (iTunes)" style="flex:1;min-width:240px;"/>
            <button id="btn-itunes-search" title="Buscar en iTunes (Apple Music)">Buscar en iTunes</button>
          </div>

          <!-- NUEVO: Asistente Gemini -->
          <div class="form-col" style="margin-top:8px;gap:8px;">
            <label>Asistente Gemini
              <div class="actions" style="gap:8px;flex-wrap:wrap;align-items:center;">
                <select id="assist-module">
                  <option value="creacion">Creaci√≥n</option>
                  <option value="publicacion">Publicaci√≥n</option>
                  <option value="web3">Web3</option>
                  <option value="marketing">Marketing</option>
                </select>
                <textarea id="assist-context" rows="3" style="flex:1;min-width:260px;" placeholder="Cu√©ntame tu objetivo o contexto..."></textarea>
                <button id="btn-assist">Asistir</button>
              </div>
            </label>
            <pre id="assist-output" class="hint" style="white-space:pre-wrap;margin:0;"></pre>
          </div>

          <ul id="mixer-results"></ul>
          <ul id="github-results"></ul>
          <!-- NUEVO: Resultados iTunes -->
          <ul id="itunes-results"></ul>
          <small class="hint">Puedes usar operadores de GitHub: repo:, path:, extension:. Ej.: repo:aetereum/Aether-Sound path:output extension:wav</small>
          <small class="hint">Reproducci√≥n remota depende de CORS/formatos del origen. Se recomienda descargar/liberar a la biblioteca local cuando sea posible.</small>
        </details>
      </div>

      <div class="panel">
        <h2>√Ålbum</h2>
        <div class="form-col">
          <label>T√≠tulo <input id="album-title" type="text" placeholder="Mi √Ålbum" /></label>
          <label>Artista <input id="album-artist" type="text" placeholder="Aether" /></label>
          <label>Descripci√≥n <textarea id="album-desc" rows="3" placeholder="Notas del √°lbum..."></textarea></label>
          <button id="btn-create-album">Crear √Ålbum</button>
          <div id="album-result" class="hint"></div>
          <div class="actions" style="margin-top:8px;gap:8px;flex-wrap:wrap;">
            <button id="btn-mint-hedera" disabled>Mint en Hedera</button>
            <button id="btn-publish-spotify" disabled>Publicar en Spotify</button>
          </div>
          <div id="publish-result" class="hint"></div>
          
          <!-- NUEVO: utilidades Hedera -->
          <hr />
          <div class="form-col">
            <h3>Split NFT Collection (Hedera)</h3>
            <div class="form-col" style="gap:8px;">
              <label>Nombre colecci√≥n <input id="split-name" type="text" placeholder="Aether Sounds Vol.1" /></label>
              <label>S√≠mbolo <input id="split-symbol" type="text" placeholder="ASND" /></label>
              <label>Tesorer√≠a <input id="split-treasury" type="text" placeholder="0.0.1234" /></label>
              <div style="border:1px solid #333;padding:8px;border-radius:6px;background:#2a2a2a;">
                <strong>Splits/Royalties:</strong>
                <div id="splits-container" style="margin-top:6px;"></div>
                <div class="actions" style="gap:8px;margin-top:6px;">
                  <button id="btn-add-split" type="button">+ A√±adir Split</button>
                  <span class="hint" id="splits-sum" style="font-size:0.85em;color:#888;">BPS total: 0</span>
                </div>
              </div>
              <div class="actions" style="gap:8px;flex-wrap:wrap;">
                <button id="btn-split-create">Crear Collection</button>
                <button id="btn-split-mint" disabled>Mint NFT</button>
                <button id="btn-split-associate" disabled>Asociar Token</button>
                <button id="btn-split-transfer" disabled>Transferir NFT</button>
              </div>
              <div class="form-col" style="margin-top:8px;gap:6px;">
                <label>Metadata NFT <textarea id="split-metadata" rows="3" placeholder='{"name":"Track #1","description":"My music","external_url":"https://aether.sound"}'></textarea></label>
                <label>Cuenta destino para transferir <input id="split-to-account" type="text" placeholder="0.0.xxxxx" /></label>
              </div>
              <div id="split-result" class="hint" style="margin-top:8px;"></div>
            </div>
            
            <hr />
            <h3>Hedera (asociaci√≥n y consulta)</h3>
            <label>AccountId artista <input id="hedera-account" type="text" placeholder="0.0.1234" /></label>
            <label>TokenId <input id="hedera-token" type="text" placeholder="0.0.5678" /></label>
            <label>Serial <input id="hedera-serial" type="number" min="0" step="1" placeholder="1" /></label>
            <label>Private Key (opcional)
              <input id="hedera-private-key" type="password" placeholder="302e..." />
            </label>
            <label>Destino (accountId)
              <input id="hedera-to" type="text" placeholder="0.0.xxxxx" />
            </label>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-assoc-check">Check asociaci√≥n</button>
              <button id="btn-assoc-prepare">Prepare asociaci√≥n</button>
              <button id="btn-assoc-submit">Submit asociaci√≥n</button>
              <button id="btn-nft-owner">Owner NFT</button>
              <button id="btn-nft-list">Listar NFTs de la cuenta</button>
              <button id="btn-nft-transfer">Transferir NFT</button>
            </div>
            <label>Transacci√≥n firmada (base64)
              <textarea id="assoc-tx-base64" rows="3" placeholder="Pega aqu√≠ la transacci√≥n firmada"></textarea>
            </label>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-copy-base64">Copiar base64</button>
              <button id="btn-clear-base64">Limpiar</button>
            </div>
            <div id="hedera-result" class="hint"></div>
            <pre id="hedera-list-pre" class="plan" title="Doble clic para cargar m√°s si hay paginaci√≥n"></pre>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-nft-my">Ver mis NFTs</button>
              <button id="btn-nft-more">Cargar m√°s</button>
            </div>
            <div id="hedera-gallery" class="grid" style="grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px;"></div>
            
            <hr />
            <h3>Wallet</h3>
            <div class="grid-3">
              <label>WalletConnect Project ID
                <input id="wc-project-id" type="text" placeholder="proj_********" />
              </label>
            </div>
            <div class="actions" style="gap:8px;flex-wrap:wrap;">
              <button id="btn-wallet-connect">Conectar Wallet</button>
              <button id="btn-assoc-wallet">Firmar asociaci√≥n (wallet)</button>
            </div>
            <div id="wallet-status" class="hint"></div>
          </div>
        </div>
      </div>
      <div class="panel" id="pulses-panel">
        <h2>Pulsos</h2>
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
           <label>D√≠as <input id="pulses-days" type="number" min="1" max="30" value="7" style="width:80px;"/></label>
           <button id="btn-pulses-latest">Ver √∫ltimo pulso</button>
           <button id="btn-pulses-generate">Generar pulso</button>
           <a id="pulses-file-link" href="#" target="_blank" class="hint" style="margin-left:8px;"></a>
         </div>
         <div id="pulses-summary" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; align-items: stretch;"></div>
         <pre id="pulses-pre" class="plan" style="display:block;max-height:200px;overflow:auto;"></pre>
      </div>

      <div class="panel" id="bi-panel">
        <h2>BI (Anal√≠tica)</h2>
        <div class="actions" style="gap:8px;align-items:center;flex-wrap:wrap;">
          <label>D√≠as
            <input id="bi-days" type="number" min="1" max="90" value="30" style="width:80px;"/>
          </label>
          <button id="btn-bi-trends">Trends</button>
          <button id="btn-bi-audience">Audience DNA</button>
          <button id="btn-bi-roi">ROI</button>
        </div>
        <div id="bi-summary" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; align-items: stretch;"></div>
        <pre id="bi-pre" class="plan" style="display:block;max-height:220px;overflow:auto;"></pre>
      </div>

      <div class="panel" id="credits-panel">
        <h2>Cr√©ditos & EPK</h2>
        <div class="form-col" style="gap:8px;">
          <div class="grid-3">
            <label>T√≠tulo <input id="cred-title" type="text" placeholder="Nombre del single/√°lbum" /></label>
            <label>Artista <input id="cred-artist" type="text" placeholder="Artista principal" /></label>
            <label>Cover URL <input id="cred-cover" type="url" placeholder="https://.../cover.jpg" /></label>
          </div>
          <div class="grid-3">
            <label>ISRC <input id="cred-isrc" type="text" placeholder="ISRC" /></label>
            <label>ISWC <input id="cred-iswc" type="text" placeholder="ISWC" /></label>
            <label>UPC/EAN <input id="cred-upc" type="text" placeholder="UPC/EAN" /></label>
          </div>
          <div class="grid-3">
            <label>Spotify <input id="cred-spotify" type="url" placeholder="https://open.spotify.com/..." /></label>
            <label>Apple Music <input id="cred-apple" type="url" placeholder="https://music.apple.com/..." /></label>
            <label>YouTube <input id="cred-youtube" type="url" placeholder="https://youtube.com/..." /></label>
          </div>
          <div class="grid-2">
            <label>Instagram <input id="cred-instagram" type="url" placeholder="https://instagram.com/..." /></label>
            <label>Website <input id="cred-website" type="url" placeholder="https://mi-sitio.com" /></label>
          </div>
          <label>Contacto <input id="cred-contact" type="text" placeholder="manager@dominio.com | +54..." /></label>
          <label>Notas <textarea id="cred-notes" rows="3" placeholder="Notas de prensa, bio, logros, gira..."></textarea></label>
          <div class="card" style="background:#2a2a2a; border:1px solid #333; border-radius:8px; padding:8px;">
            <strong>People (rol ‚Üí nombre)</strong>
            <div id="cred-people" class="form-col" style="gap:6px;"></div>
            <div class="actions" style="gap:8px;">
              <button id="btn-people-add" type="button">+ A√±adir persona</button>
            </div>
          </div>
          <div class="card" style="background:#2a2a2a; border:1px solid #333; border-radius:8px; padding:8px;">
            <strong>Splits (party ‚Üí BPS)</strong>
            <div id="cred-splits" class="form-col" style="gap:6px;"></div>
            <div class="actions" style="gap:8px;">
              <button id="btn-split-add" type="button">+ A√±adir split</button>
              <span id="cred-bps-sum" class="hint">BPS total: 0</span>
            </div>
          </div>
          <div class="actions" style="gap:8px; flex-wrap:wrap;">
            <button id="btn-cred-save">Guardar cr√©ditos</button>
            <button id="btn-epk-gen">Generar EPK</button>
            <a id="epk-link" href="#" target="_blank" class="hint"></a>
          </div>
          <pre id="cred-result" class="plan" style="display:block;max-height:160px;overflow:auto;"></pre>
        </div>
      </div>
    </section>
  </main>

  <!-- Paleta de Comandos (Ctrl+K) -->
  <div id="cmdk" class="cmdk hidden" role="dialog" aria-modal="true" aria-label="Paleta de Comandos">
    <div class="cmdk-panel">
      <input id="cmdk-input" type="text" placeholder="Escribe un comando (ej: play a, stop b, cargar a, buscar itunes)" autocomplete="off" />
      <ul id="cmdk-list"></ul>
      <div class="cmdk-hint">Enter para ejecutar ‚Ä¢ ESC para cerrar</div>
    </div>
  </div>

  <!-- ===== INICIO DEL CHATBOT DE IA ===== -->
  <div id="chatbot-container">
    <div id="chatbot-widget" class="hidden">
      <div id="chatbot-header">
        <span>AetherBot</span>
        <button id="chatbot-close-btn">&times;</button>
      </div>
      <div id="chatbot-messages">
        <!-- Mensaje de bienvenida -->
        <div class="bot-message">
          <p>¬°Hola! Soy AetherBot. Estoy aqu√≠ para ayudarte a navegar Aether-Sound. ¬øEn qu√© puedo ayudarte? (Recuerda tener tu API Key de Gemini en los ajustes).</p>
        </div>
      </div>
      <div id="chatbot-input-container">
        <input type="text" id="chatbot-input" placeholder="Escribe tu pregunta...">
        <button id="chatbot-send-btn">Enviar</button>
      </div>
    </div>
    <button id="chatbot-toggle-btn">
      <!-- Icono de chatbot (puedes usar una imagen o un emoji) -->
      ü§ñ
    </button>
  </div>
  <!-- ===== FIN DEL CHATBOT DE IA ===== -->

  <footer>
    <small>¬© 2025 Aether Sound</small>
  </footer>

  <script src="/client.js"></script>
  <script src="/innovations.js"></script>
</body>
</html>